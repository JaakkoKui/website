<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ketunkolo Games</title>
    <link rel="stylesheet" href="../css/styles.css" />
    <style>
      :root {
        --radius: 10px;
        --card: #0b111b;
        --card-b: #27313d;
        --accent: #ff7b29;
      }
      html, body { height: 100%; }
      body {
        margin: 0;
        color: #e6edf3;
        background: #0d1117;
        font-family: system-ui, sans-serif;
        overflow: hidden; /* prevent page scroll */
      }
      .wrap {
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        padding: 1rem;
        margin: 0 auto;
        max-width: 1100px;
      }
      .breadcrumb {
        font-size: 0.85rem;
        margin: 0;
      }
      .breadcrumb a {
        color: #9acaff;
        text-decoration: none;
      }
      h1 {
        margin: 0;
        font-size: 1.6rem;
      }
      .controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .controls .fs-btn {
        margin-left: auto;
        background: var(--card);
        border: 1px solid var(--card-b);
        color: inherit;
        padding: 0.4rem 0.7rem;
        border-radius: 8px;
        cursor: pointer;
      }
      .controls .fs-btn:hover { border-color: var(--accent); }
      .game-frame {
        flex: 1 1 auto;
        min-height: 0; /* allow flex item to shrink */
        width: 100%;
        background: #111;
        border: 1px solid var(--card-b);
        border-radius: var(--radius);
        display: block;
      }
      #game-error {
        margin: 0.25rem 0 0;
        color: #f88;
        font-weight: 600;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <p class="breadcrumb"><a href="../index.html">‚Üê Etusivulle</a></p>
      <h1>The Game</h1>
      <div class="controls">
        <button id="fs-btn" type="button" class="fs-btn">Fullscreen</button>
      </div>
      <iframe
        id="game-frame"
        title="Game"
        loading="lazy"
        allowfullscreen
        class="game-frame"
        style="border: none"
      ></iframe>
      <div id="game-error"></div>

      <script>
        (function () {
          const frame = document.getElementById("game-frame");
          const err = document.getElementById("game-error");
          const fsBtn = document.getElementById("fs-btn");

          // Resolve preferred source: try Phaser v2 first, then pygbag web.
          (async function chooseSource() {
            const tryList = ["v2/index.html", "web/index.html"];
            for (const url of tryList) {
              try {
                const r = await fetch(url, { method: "HEAD", cache: "no-store" });
                if (r.ok) {
                  frame.src = url;
                  return;
                }
              } catch {}
            }
            err.textContent = "No game entry found (v2/index.html or web/index.html).";
            err.style.display = "block";
          })();

          // Fullscreen toggle
          function isFs() {
            return (
              document.fullscreenElement || document.webkitFullscreenElement
            );
          }
          function updateFsBtn() {
            fsBtn.textContent = isFs() ? "Exit Fullscreen" : "Fullscreen";
          }
          function enterFs(el) {
            if (el.requestFullscreen) return el.requestFullscreen();
            if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen(); // Safari
          }
          function exitFs() {
            if (document.exitFullscreen) return document.exitFullscreen();
            if (document.webkitExitFullscreen)
              return document.webkitExitFullscreen();
          }
          fsBtn.addEventListener("click", () => {
            if (isFs()) exitFs();
            else enterFs(frame);
          });
          document.addEventListener("fullscreenchange", updateFsBtn);
          document.addEventListener("webkitfullscreenchange", updateFsBtn);
          updateFsBtn();
        })();
      </script>
    </div>
  </body>
</html>
