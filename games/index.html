<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ketunkolo Games</title>
    <link rel="stylesheet" href="../css/styles.css" />
    <style>
      :root {
        --radius: 10px;
        --card: #0b111b;
        --card-b: #27313d;
        --accent: #ff7b29;
      }
      body {
        padding: 2rem;
        color: #e6edf3;
        background: #0d1117;
        font-family: system-ui, sans-serif;
      }
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
      }
      .breadcrumb {
        font-size: 0.85rem;
        margin-bottom: 0.5rem;
      }
      .breadcrumb a {
        color: #9acaff;
        text-decoration: none;
      }
      h1 {
        margin: 0 0 0.25rem;
        font-size: 1.6rem;
      }
      .lead {
        margin: 0.25rem 0 0.75rem;
      }
      .game-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
        margin: 0.5rem 0 0.75rem;
        padding: 0;
        list-style: none;
      }
      .game-list a {
        display: inline-block;
        padding: 0.55rem 0.8rem;
        background: var(--card);
        border: 1px solid var(--card-b);
        border-radius: 8px;
        color: inherit;
        text-decoration: none;
      }
      .game-list a.active {
        border-color: var(--accent);
        background: #161b22;
      }

      /* New: list + fullscreen on one row */
      .controls {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 0.25rem 0 0.5rem;
      }
      .controls .fs-btn {
        margin-left: auto;
        background: var(--card);
        border: 1px solid var(--card-b);
        color: inherit;
        padding: 0.4rem 0.7rem;
        border-radius: 8px;
        cursor: pointer;
      }
      .controls .fs-btn:hover {
        border-color: var(--accent);
      }

      .game-frame {
        width: 100%;
        height: 70vh;
        min-height: 520px;
        background: #111;
        border: 1px solid var(--card-b);
        border-radius: var(--radius);
        display: block;
        margin-bottom: 8px; /* tiny bottom margin */
      }
      #game-error {
        margin: 0.5rem 0;
        color: #f88;
        font-weight: 600;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <p class="breadcrumb"><a href="../index.html">‚Üê Etusivulle</a></p>
      <h1>Pelit</h1>
      <p class="lead">
        Valitse peli listasta. Peli avautuu alla olevaan ikkunaan.
      </p>

      <!-- Replace the separate list + toolbar with a single controls row -->
      <div class="controls">
        <ul class="game-list" id="game-list">
          <li><a href="?g=web" data-game="web">Ketunkolo (web)</a></li>
          <li><a href="?g=v2" data-game="v2">Ketunkolo v2</a></li>
        </ul>
        <button id="fs-btn" type="button" class="fs-btn">Fullscreen</button>
      </div>

      <iframe
        id="game-frame"
        title="Game"
        loading="lazy"
        allowfullscreen
        class="game-frame"
        style="border: none"
      ></iframe>
      <div id="game-error"></div>

      <script>
        (function () {
          const frame = document.getElementById("game-frame");
          const links = document.querySelectorAll("#game-list a[data-game]");
          const err = document.getElementById("game-error");
          const fsBtn = document.getElementById("fs-btn");

          // Prefer inside /games/, fall back to project root ../v2 if needed
          const map = {
            web: ["web/index.html"],
            v2: ["v2/index.html", "../v2/index.html"],
          };

          const params = new URLSearchParams(location.search);
          const current = params.get("g") || "web";

          async function exists(url) {
            try {
              const r = await fetch(url, { method: "HEAD", cache: "no-store" });
              return r.ok;
            } catch {
              return false;
            }
          }

          async function resolveSrc(key) {
            const candidates = map[key] || map.web;
            for (const url of candidates) if (await exists(url)) return url;
            return null;
          }

          async function setGame(key) {
            err.style.display = "none";
            const src = await resolveSrc(key);
            if (src) {
              frame.src = src;
            } else {
              frame.removeAttribute("src");
              err.textContent = `Game "${key}" not found. Checked: ${(
                map[key] || []
              ).join(", ")}`;
              err.style.display = "block";
            }
            links.forEach((a) =>
              a.classList.toggle("active", a.dataset.game === key)
            );
          }

          setGame(current);

          links.forEach((a) =>
            a.addEventListener("click", (e) => {
              e.preventDefault();
              const key = a.dataset.game;
              history.replaceState(null, "", "?g=" + encodeURIComponent(key));
              setGame(key);
            })
          );

          // Fullscreen toggle
          function isFs() {
            return (
              document.fullscreenElement || document.webkitFullscreenElement
            );
          }
          function updateFsBtn() {
            fsBtn.textContent = isFs() ? "Exit Fullscreen" : "Fullscreen";
          }
          function enterFs(el) {
            if (el.requestFullscreen) return el.requestFullscreen();
            if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen(); // Safari
          }
          function exitFs() {
            if (document.exitFullscreen) return document.exitFullscreen();
            if (document.webkitExitFullscreen)
              return document.webkitExitFullscreen();
          }
          fsBtn.addEventListener("click", () => {
            if (isFs()) exitFs();
            else enterFs(frame);
          });
          document.addEventListener("fullscreenchange", updateFsBtn);
          document.addEventListener("webkitfullscreenchange", updateFsBtn);
          updateFsBtn();
        })();
      </script>
    </div>
  </body>
</html>
